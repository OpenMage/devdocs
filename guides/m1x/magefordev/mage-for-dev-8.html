---
---
<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>OpenMage for Developers: Part 8&mdash;Varien Data Collections</title>
    <meta name="description" content="OpenMage LTS Developer Documentation.">

    <link rel="stylesheet" href="/assets/css/app.css"/>
    <link rel="stylesheet" href="/assets/css/print.css" media="print"/>
    <link rel="stylesheet" type="text/css" href="/common/css/stylesheet.css">

    <link rel="stylesheet" href="/common/css/stylesheet-fonts.css" type="text/css">
    <link rel="stylesheet" href="/common/css/devdocs.css"/>
    <link rel="alternate" type="application/rss+xml" title="OpenMage DevDocs RSS" href="/feed.xml"/>

    <script>
        var baseUrl = "";
        var algolia = {
            id: "E642SEDTHL",
            index: "devdocs",
            key: "d2d0f33ab73e291ef8d88d8b565e754c"
        };
    </script>

    <link rel="shortcut icon" type="image/x-icon" href="/common/css/favicon.ico">
    <link rel="icon" type="image/png" href="/common/images/openmage-touch-icon.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/common/images/openmage-touch-icon.png" sizes="96x96">
</head>
<body class="layout-default">
<header class="site-header">
    <nav class="site-nav">
        <div class="menu-btn">
            <button id="menu-btn" class="menu-trigger menu-icon" aria-haspopup="true" aria-controls="nav-main"></button>
        </div>
        <div class="nav-container">
            <a class="logo" href="/">
                <svg width="257" height="63" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
                    <defs>
                        <style>.ba {
                            fill: #fb0e70;
                        }

                        .bb {
                            fill: #fff;
                            font-size: 45px;
                        }

                        .bb, .bc {
                            font-family: Poppins-SemiBold, Poppins;
                            font-weight: 600;
                            letter-spacing: -0.05em;
                            fill: #F1F1F1
                        }

                        .bc {
                            fill: #707070;
                            font-size: 38px;
                        }</style>
                    </defs>
                    <g class="layer">
                        <title>OpenMage</title>
                        <path class="ba"
                              d="m11,3.25l34,0a8,8 0 0 1 8,8l0,34a0,0 0 0 1 0,0l-42,0a0,0 0 0 1 0,0l0,-42a0,0 0 0 1 0,0z"/>
                        <text class="bb" id="svg_2" x="0" y="47">
                            <tspan x="0" y="47">m</tspan>
                        </text>
                        <text class="bc" transform="translate(56 40)">
                            <tspan x="0" y="0">openmage</tspan>
                        </text>
                    </g>
                </svg>
                <span class="site-logo">DevDocs</span>
            </a>
            <div id="nav-main" class="nav-main-wrap" aria-labelledby="menu-btn">
                <!-- Main Navigation -->
                <ul class="nav-main" role="menubar">
                    <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
                        <span tabindex="-1">Setup</span>
                        <div class="nav-popup">
                            <ul>
                                <li class="active " role="menuitem">
                                    <a href="/guides/v19.x/install-gde/install-flow-diagram.html">Installation Guide</a>
                                </li>
                                <li class=" " role="menuitem">
                                    <a href="/guides/v19.x/migration/bk-migration-guide.html">Migration Guide</a>
                                </li>
                                <li class=" " role="menuitem">
                                    <a href="/guides/v19.x/release-notes/bk-release-notes.html">Release Information</a>
                                </li>
                            </ul>
                        </div>
                    </li>
                    <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
                        <span tabindex="-1">Development</span>
                        <div class="nav-popup">
                            <div class="nav-section">
                                <div class="nav-section-title">Backend</div>
                                <ul>
                                    <li class=" " role="menuitem">
                                        <a href="/guides/v19.x/">Architecture</a>
                                    </li>
                                    <li class=" " role="menuitem">
                                        <a href="/guides/v19.x/">PHP Developer Guide</a>
                                    </li>
                                    <li class=" " role="menuitem">
                                        <a href="/guides/v19.x/">Extension Developer Best Practices</a>
                                    </li>
                                    <li class=" " role="menuitem">
                                        <a href="/guides/v19.x/">Module Reference Guide</a>
                                    </li>
                                    <li class=" " role="menuitem">
                                        <a href="/guides/v19.x/">Coding Standards</a>
                                    </li>
                                    <li class=" " role="menuitem">
                                        <a href="https://github.com/OpenMage/magento-lts">Contribute!</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="nav-section">
                                <div class="nav-section-title">Frontend</div>
                                <ul>
                                    <li class=" " role="menuitem">
                                        <a href="/guides/v19.x/">Frontend Developer Guide</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="nav-section">
                                <div class="nav-section-title">API</div>
                                <ul>
                                    <li class=" " role="menuitem">
                                        <a href="/guides/v19.x/">Get Started with OpenMage Web APIs</a>
                                    </li>
                                    <li class=" " role="menuitem">
                                        <a href="/guides/v19.x/api/rest-api-index.html">REST API Reference</a>
                                    </li>
                                    <li class=" " role="menuitem">
                                        <a href="/guides/v19.x/api/soap-api-index.html">SOAP API Reference</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
                        <span tabindex="-1">Testing</span>
                        <div class="nav-popup">
                            <ul>
                                <li class=" " role="menuitem">
                                    <a href="/mftf/2.3/introduction.html">Functional Acceptance Testing (MFTF)</a>
                                </li>
                            </ul>
                        </div>
                    </li>
                    <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
                        <span tabindex="-1">Functional Areas</span>
                        <div class="nav-popup">
                            <ul>
                                <li class=" " role="menuitem">
                                    <span>Advanced Reporting</span>
                                </li>
                                <li class=" " role="menuitem">
                                    <a href="/guides/v19.x/howdoi/checkout/checkout_overview.html">Checkout</a>
                                </li>
                                <li class=" " role="menuitem">
                                    <a href="/guides/v19.x/inventory/index.html">Inventory Management</a>
                                </li>
                                <li class=" " role="menuitem">
                                    <a href="http://omsdocs.magento.com/en/">Order Management</a>
                                </li>
                            </ul>
                        </div>
                    </li>
                    <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
                        <span tabindex="-1">Old Documantation</span>
                        <div class="nav-popup">
                            <ul>
                                <li class=" " role="menuitem">
                                    <a href="/guides/v19.x/">Magento 1 Docs</a>
                                </li>
                            </ul>
                        </div>
                    </li>
                </ul><!-- /.nav-main -->
            </div>
            <div class="search-btn">
                <button class="search-trigger search-icon" aria-label="Search"></button>
            </div>
            <form class="quick-search" action="/search.html" method="get" novalidate="novalidate">
                <input type="search" name="q" placeholder="Search"/>
                <button class="quick-search-close" aria-label="Close Search">&times;</button>
            </form>
        </div>
    </nav><!-- #site-nav -->
    <div class="nav-main-fader"></div>
</header>
<div class="global-wrapper">
    <div class="main-container">
        <a id="main-content"></a>
        <div class="content-container">
            <!-- sidebar -->
            <aside class="sidebar">
                <a href="#" data-proofer-ignore class="toc-toggler">Table of Contents</a>
                <div class="sidebar-wrapper">
                    <h4 class="guide-title">Developer Guide</h4>
                    <div class="collapsible-navigation">
                        <ul>
                            <li class="" role="menuitem">
                                <a href="{{ site.v1xgdeurl }}/magefordev/mage-for-dev-1.html">
                                    Introduction to OpenMage
                                </a>
                            </li>
                            <li class="" role="menuitem">
                                <a href="{{ site.v1xgdeurl }}/magefordev/mage-for-dev-2.html">
                                    The OpenMage Config
                                </a>
                            </li>
                            <li class="" role="menuitem">
                                <a href="{{ site.v1xgdeurl }}/magefordev/mage-for-dev-3.html">
                                    Controller Dispatch
                                </a>
                            </li>
                            <li class="" role="menuitem">
                                <a href="{{ site.v1xgdeurl }}/magefordev/mage-for-dev-4.html">
                                    Layouts, Blocks and Templates
                                </a>
                            </li>
                            <li class="" role="menuitem">
                                <a href="{{ site.v1xgdeurl }}/magefordev/mage-for-dev-5.html">
                                    Models and ORM Basics
                                </a>
                            </li>
                            <li class="" role="menuitem">
                                <a href="{{ site.v1xgdeurl }}/magefordev/mage-for-dev-6.html">
                                    Setup Resources
                                </a>
                            </li>
                            <li class="" role="menuitem">
                                <a href="{{ site.v1xgdeurl }}/magefordev/mage-for-dev-7.html">
                                    Advanced ORM: Entity Attribute Value
                                </a>
                            </li>
                            <li class="active" role="menuitem">
                                <a href="{{ site.v1xgdeurl }}/magefordev/mage-for-dev-8.html">
                                    Varien Data Collections
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </aside>
            <!-- /sidebar -->
            <section class="content">
                <div class="content-wrap">
                    <!-- page-header -->
                    <section class="page-intro">
                        <h1 class="page-heading">Varien Data Collections</h1>
                    </section>

                    <p class="para1">Originally, as a PHP programmer, if you wanted to collect together a group of
                        related variables you had one choice, the venerable <a
                                href="http://us.php.net/manual/en/language.types.array.php">Array</a>. While it shares a
                        name with C's array of memory addresses, a PHP array is a general purpose dictionary like object
                        combined with the behaviors of a numerically indexed mutable array.</p>

                    <p>In other languages the choice isn't so simple. You have <a
                            href="http://en.wikipedia.org/wiki/List_of_data_structures#Linear_data_structures">multiple
                        data structures</a> to chose from, each offering particular advantages in storage, speed and
                        semantics. The PHP philosophy was to remove this choice from the client programmer and give them
                        one useful data structure that was "good enough". </p>

                    <p>All of this is galling to a certain type of software developer, and PHP 5 set out to change the
                        status quo by offering built-in classes and interfaces that allow you to create your own data
                        structures. </p>

                    <pre>
$array = new ArrayObject();
class MyCollection extends ArrayObject{...}
$collection = new MyCollection();
$collection[] = 'bar';
</pre>

                    <p>While this is still galling to a certain type of software developer, as you don't have access to
                        low level implementation details, you do have the ability to create array-like Objects with
                        methods that encapsulate specific functionality. You can also setup rules to offer a level of
                        type safety by only allowing certain kinds of Objects into your Collection.</p>

                    <p>It should come as no surprise that OpenMage offers you a number of these Collections. In fact,
                        every Model object that follows the OpenMage interfaces gets a Collection type for free.
                        Understanding how these Collections work is a key part to being an effective OpenMage programmer.
                        We're going to take a look at OpenMage Collections, starting from the bottom and working our way
                        up. Set up a <a href="http://alanstorm.com/magento_controller_hello_world">controller action</a>
                        where you can run arbitrary code, and let's get started.</p>

                    <h2 id="a-collection-of-things">A Collection of Things</h2>

                    <p>First, we're going to create a few new Objects.</p>

                    <pre>
$thing_1 = new Varien_Object();
$thing_1->setName('Richard');
$thing_1->setAge(24);

$thing_2 = new Varien_Object();
$thing_2->setName('Jane');
$thing_2->setAge(12);

$thing_3 = new Varien_Object();
$thing_3->setName('Spot');
$thing_3->setLastName('The Dog');
$thing_3->setAge(7);
</pre>

                    <p>The <tt>Varien_Object</tt> class defines the object all OpenMage Models inherit from. This is a
                        common pattern in object oriented systems, and ensures you'll always have a way to easily add
                        methods/functionally to <strong>every</strong> object in your system without having to edit
                        every class file.</p>

                    <p>Any Object that extends from <tt>Varien_Object</tt> has magic getter and setters that can be used
                        to set data properties. Give this a try</p>

                    <pre>var_dump($thing_1->getName());</pre>

                    <p>If you don't know what the property name you're after is, you can pull out all the data as an
                        array</p>

                    <pre>var_dump($thing_3->getData());</pre>

                    <p>The above will give you an array something like</p>


                    <pre>
array
'name' => string 'Spot' (length=4)
'last_name' => string 'The Dog' (length=7)
'age' => int 7
</pre>

                    <p>Notice the property named "last_name"? If there's an underscore separated property, you camel
                        case it if you want to use the getter and setter magic.</p>

                    <pre>$thing_1->setLastName('Smith');</pre>

                    <p>The ability to do these kinds of things is part of the power of PHP5, and the development style a
                        certain class of people mean when they say "Object Oriented Programming".</p>

                    <p>So, now that we have some Objects, let's add them to a Collection. Remember, a Collection is like
                        an Array, but is defined by a PHP programmer. </p>

                    <pre>
$collection_of_things = new Varien_Data_Collection();
$collection_of_things
    ->addItem($thing_1)
    ->addItem($thing_2)
    ->addItem($thing_3);
</pre>

                    <p>The <tt>Varien_Data_Collection</tt> is the Collection that most OpenMage data Collections inherit
                        from. Any method you can call on a <tt>Varien_Data_Collection</tt> you can call on Collections
                        higher up the chain (We'll see more of this later)</p>

                    <p>What can we do with a Collection? For one, with can use <tt>foreach</tt> to iterate over it</p>

                    <pre>
foreach($collection_of_things as $thing)
{
    var_dump($thing->getData());
}
</pre>

                    <p>There are also shortcuts for pulling out the first and last items</p>

                    <pre>
var_dump($collection_of_things->getFirstItem()->getData());
var_dump($collection_of_things->getLastItem()->getData());
</pre>

                    <p>Want your Collection data as XML? There's a method for that</p>

                    <pre>var_dump( $collection_of_things->toXml() );</pre>

                    <p>Only want a particular field?</p>

                    <pre>var_dump($collection_of_things->getColumnValues('name'));</pre>

                    <p>The team at OpenMage have even given us some rudimentary filtering capabilities.</p>

                    <pre>var_dump($collection_of_things->getItemsByColumnValue('name','Spot'));</pre>

                    <p>Neat stuff.</p>

                    <h2 id="model-collections">Model Collections</h2>
                    <p>So, this is an interesting exercise, but why do we care? </p>

                    <p>We care because all of OpenMage's built in data Collections inherit from this object. That means
                        if you have, say, a product Collection you can do the same sort of things. Let's take a
                        look </p>

                    <pre>
public function testAction()
{
    $collection_of_products = Mage::getModel('catalog/product')->getCollection();
    var_dump($collection_of_products->getFirstItem()->getData());
}
</pre>

                    <p>Most OpenMage Model objects have a method named <tt>getCollection</tt> which will return a
                        collection that, by default, is initialized to return every Object of that type in the system.
                    </p>

                    <p><strong>A Quick Note:</strong> OpenMage's Data Collections contain a lot of complicated logic that
                        handles when to use an index or cache, as well as the logic for the EAV entity system.
                        Successive method calls to the same Collection over its life can often result in unexpected
                        behavior. Because of that, all the of the following examples are wrapped in a single method
                        action. I'd recommend doing the same while you're experimenting. Also, <a
                                href="http://xdebug.org/">XDebug's</a> <tt>var_dump</tt> is a godsend when working with
                        OpenMage Objects and Collections, as it will (usually) intelligently short circuit showing hugely
                        recursive Objects, but still display a useful representation of the Object structure to you.</p>

                    <p>The products Collection, as well as many other OpenMage Collections, also have the <tt>Varien_Data_Collection_Db</tt>
                        class in their ancestor chain. This gives us a lot of useful methods. For example, if you want
                        to see the select statement your Collection is using</p>

                    <pre>
public function testAction()
{
    $collection_of_products = Mage::getModel('catalog/product')->getCollection();
    var_dump($collection_of_products->getSelect()); //might cause a segmentation fault
}
</pre>

                    <p>The output of the above will be</p>

                    <pre>
object(Varien_Db_Select)[94]
  protected '_bind' =>
    array
      empty
  protected '_adapter' =>
...
</pre>

                    <p>Whoops! Since OpenMage is using the <tt>Zend</tt> database abstraction layer, your Select is also
                        an Object. Let's see that as a more useful string. </p>

                    <pre>
public function testAction()
{
    $collection_of_products = Mage::getModel('catalog/product')->getCollection();
    //var_dump($collection_of_products->getSelect()); //might cause a segmentation fault
    var_dump(
        (string) $collection_of_products->getSelect()
    );
}
</pre>

                    <p>Sometimes this is going to result in a simple select</p>

                    <pre>'SELECT `e`.* FROM `catalog_product_entity` AS `e`'</pre>

                    <p>Other times, something a bit more complex</p>

                    <pre>
string 'SELECT `e`.*, `price_index`.`price`, `price_index`.`final_price`, IF(`price_index`.`tier_price`,
LEAST(`price_index`.`min_price`, `price_index`.`tier_price`), `price_index`.`min_price`) AS `minimal_price`,
`price_index`.`min_price`, `price_index`.`max_price`, `price_index`.`tier_price` FROM `catalog_product_entity`
AS `e` INNER JOIN `catalog_product_index_price` AS `price_index` ON price_index.entity_id = e.entity_id AND
price_index.website_id = '1' AND price_index.customer_group_id = 0'
</pre>

                    <p>The discrepancy depends on which attributes you're selecting, as well as the aforementioned
                        indexing and cache. If you've been following along with the other articles in this series, you
                        know that many OpenMage models (including the Product Model) use an <a
                                href="http://en.wikipedia.org/wiki/EAV">EAV</a> system. By default, a EAV Collection
                        will not include all of an Object's attributes. You can add them all by using the
                        addAttributeToSelect method</p>

                    <pre>
$collection_of_products = Mage::getModel('catalog/product')
    ->getCollection()
    ->addAttributeToSelect('*');  //the asterisk is like a SQL SELECT * FROM ...
</pre>

                    <p>Or, you can add just one</p>

                    <pre>
//or just one
$collection_of_products = Mage::getModel('catalog/product')
    ->getCollection()
    ->addAttributeToSelect('meta_title');
</pre>

                    <p>or chain together several</p>

                    <pre>
//or just one
$collection_of_products = Mage::getModel('catalog/product')
    ->getCollection()
    ->addAttributeToSelect('meta_title')
    ->addAttributeToSelect('price');
</pre>

                    <h2 id="lazy-loading">Lazy Loading</h2>

                    <p>One thing that will trip up PHP developers new to OpenMage's ORM system is <strong>when</strong>
                        OpenMage makes its database calls. When you're writing literal SQL, or even when you're using a
                        basic ORM system, SQL calls are often made immediately when instantiating an Object.</p>

                    <pre>
$model = new Customer();
//SQL Calls being made to Populate the Object
echo 'Done'; //execution continues
</pre>

                    <p>OpenMage doesn't work that way. Instead, the concept of <a
                            href="http://en.wikipedia.org/wiki/Lazy_loading">Lazy Loading</a> is used. In simplified
                        terms, Lazy loading means that no SQL calls are made until the client-programmer needs to access
                        the data. That means when you do something something like this</p>

                    <pre>
$collection_of_products = Mage::getModel('catalog/product')
    ->getCollection();
</pre>

                    <p>OpenMage actually hasn't gone out to the database yet. You can safely add attributes later</p>

                    <pre>
$collection_of_products = Mage::getModel('catalog/product')
    ->getCollection();
$collection_of_products->addAttributeToSelect('meta_title');
</pre>

                    <p>and not have to worry that OpenMage is making a database query each time a new attribute is added.
                        The database query will not be made until you attempt to access an item in the Collection.</p>

                    <p>In general, try not to worry too much about the implementation details in your day to day work.
                        It's good to know that there's s SQL backend and OpenMage is doing SQLy things, but when you're
                        coding up a feature try to forget about it, and just treat the objects as block boxes that do
                        what you need. </p>

                    <h2 id="filtering-database-collections">Filtering Database Collections</h2>

                    <p>The most important method on a database Collection is <tt>addFieldToFilter</tt>. This adds your
                        <tt>WHERE</tt> clauses to the SQL query being used behind the scenes. Consider this bit of code,
                        run against the sample data database (substitute your own SKU is you're using a different set of
                        product data)</p>

                    <pre>
public function testAction()
{
    $collection_of_products = Mage::getModel('catalog/product')
        ->getCollection();
    $collection_of_products->addFieldToFilter('sku','n2610');

    //another neat thing about collections is you can pass them into the count      //function.  More PHP5 powered goodness
    echo "Our collection now has " . count($collection_of_products) . ' item(s)';
    var_dump($collection_of_products->getFirstItem()->getData());
}
</pre>

                    <p>The first parameter of <tt>addFieldToFilter</tt> is the attribute you wish to filter by. The
                        second is the value you're looking for. Here's we're adding a <tt>sku</tt> filter for the value
                        <tt>n2610</tt>.</p>

                    <p>The second parameter can also be used to specify the <strong>type</strong> of filtering you want
                        to do. This is where things get a little complicated, and worth going into with a little more
                        depth.</p>

                    <p>So by default, the following </p>

                    <pre>$collection_of_products->addFieldToFilter('sku','n2610');</pre>

                    <p>is (essentially) equivalent to </p>

                    <pre>WHERE sku = "n2610"</pre>

                    <p>Take a look for yourself. Running the following</p>

                    <pre>
public function testAction()
{
    var_dump(
    (string)
    Mage::getModel('catalog/product')
    ->getCollection()
    ->addFieldToFilter('sku','n2610')
    ->getSelect());
}
</pre>

                    <p>will yield</p>

                    <pre>SELECT `e`.* FROM `catalog_product_entity` AS `e` WHERE (e.sku = 'n2610')'</pre>

                    <p>Keep in mind, this can get complicated fast if you're using an EAV attribute. Add an
                        attribute</p>

                    <pre>
var_dump(
    (string)
    Mage::getModel('catalog/product')
        ->getCollection()
        ->addAttributeToSelect('*')
        ->addFieldToFilter('meta_title','my title')
        ->getSelect()
);
</pre>

                    <p>and the query gets gnarly.</p>

                    <pre>
SELECT `e`.*, IF(_table_meta_title.value_id>0, _table_meta_title.value, _table_meta_title_default.value) AS `meta_title`
FROM `catalog_product_entity` AS `e`
INNER JOIN `catalog_product_entity_varchar` AS `_table_meta_title_default`
    ON (_table_meta_title_default.entity_id = e.entity_id) AND (_table_meta_title_default.attribute_id='103')
    AND _table_meta_title_default.store_id=0
LEFT JOIN `catalog_product_entity_varchar` AS `_table_meta_title`
    ON (_table_meta_title.entity_id = e.entity_id) AND (_table_meta_title.attribute_id='103')
    AND (_table_meta_title.store_id='1')
WHERE (IF(_table_meta_title.value_id>0, _table_meta_title.value, _table_meta_title_default.value) = 'my title')
</pre>

                    <p>Not to belabor the point, but try not to think too much about the SQL if you're on deadline.</p>

                    <h2 id="other-comparison-operators">Other Comparison Operators</h2>

                    <p>I'm sure you're wondering "what if I want something other than an equals by query"? Not equal,
                        greater than, less than, etc. The <tt>addFieldToFilter</tt> method's second parameter has you
                        covered there as well. It supports an alternate syntax where, instead of passing in a string,
                        you pass in a single element Array. </p>

                    <p>The key of this array is the <strong>type</strong> of comparison you want to make. The value
                        associated with that key is the value you want to filter by. Let's redo the above filter, but
                        with this explicit syntax</p>

                    <pre>public function testAction()
{
    var_dump(
        (string)
        Mage::getModel('catalog/product')
            ->getCollection()
            ->addFieldToFilter('sku', array('eq'=>'n2610'))
            ->getSelect()
    );
}
</pre>

                    <p>Calling out our filter</p>

                    <pre>addFieldToFilter('sku',array('eq'=>'n2610'))</pre>

                    <p>As you can see, the second parameter is a PHP Array. Its key is <tt>eq</tt>, which stands for
                        <em>equals</em>. The value for this key is <tt>n2610</tt>, which is the value we're filtering
                        on.</p>

                    <p>OpenMage has a number of these english language like filters that will bring a <a
                            href="http://www.shlomifish.org/lecture/Perl/Newbies/lecture1/conditionals/string.html">tear
                        of remembrance</a> (and perhaps pain) to any old perl developers in the audience.</p>

                    <p>Listed below are all the filters, along with an example of their SQL equivalents.</p>

                    <pre>
array("eq"=>'n2610')
WHERE (e.sku = 'n2610')

array("neq"=>'n2610')
WHERE (e.sku != 'n2610')

array("like"=>'n2610')
WHERE (e.sku like 'n2610')

array("nlike"=>'n2610')
WHERE (e.sku not like 'n2610')

array("is"=>'n2610')
WHERE (e.sku is 'n2610')

array("in"=>array('n2610'))
WHERE (e.sku in ('n2610'))

array("nin"=>array('n2610'))
WHERE (e.sku not in ('n2610'))

array("notnull"=>true)
WHERE (e.sku is NOT NULL)

array("null"=>true)
WHERE (e.sku is NULL)

array("gt"=>'n2610')
WHERE (e.sku > 'n2610')

array("lt"=>'n2610')
WHERE (e.sku &lt; 'n2610')

array("gteq"=>'n2610')
WHERE (e.sku >= 'n2610')

array("moreq"=>'n2610') //a weird, second way to do greater than equal (Doesn't work on > 1.8 CE EDITION do the same as eq)
WHERE (e.sku >= 'n2610')

array("lteq"=>'n2610')
WHERE (e.sku &lt;= 'n2610')

array("finset"=>array('n2610'))
WHERE (find_in_set('n2610',e.sku))

array('from'=>'10','to'=>'20')
WHERE e.sku >= '10' and e.sku &lt;= '20'
</pre>

                    <p>Most of these are self explanatory, but a few deserve a special callout</p>

                    <h3>in, nin, find_in_set</h3>

                    <p>The <tt>in</tt>, <tt>nin</tt> and <tt>finset</tt> conditionals allow you to pass in an Array of
                        values. That is, the value portion of your filter array is itself allowed to be an array. </p>

                    <pre>
array("in"=>array('n2610','ABC123')
WHERE (e.sku in ('n2610','ABC123'))
</pre>

                    <h3>notnull, null</h3>

                    <p>The keyword NULL is special in most flavors of SQL. It typically won't play nice with the
                        standard equality (<tt>=</tt>) operator. Specifying <tt>notnull</tt> or <tt>null</tt> as your
                        filter type will get you the correct syntax for a NULL comparison while ignoring whatever value
                        you pass in</p>

                    <pre>
array("notnull"=>true)
WHERE (e.sku is NOT NULL)
</pre>

                    <h3>from - to filter</h3>
                    <p>This is another special format that breaks the standard rule. Instead of a single element array,
                        you specify a two element array. One element has the key <tt>from</tt>, the other element has
                        the key <tt>to</tt>. As the keys indicated, this filter allows you to construct a from/to range
                        without having to worry about greater than and less than symbols</p>

                    <pre>
public function testAction
{
    var_dump(
        (string)
        Mage::getModel('catalog/product')
            ->getCollection()
            ->addFieldToFilter('price',array('from'=>'10','to'=>'20'))
            ->getSelect()
    );
}
</pre>

                    <p>The above yields</p>
                    <pre>WHERE (_table_price.value >= '10' and _table_price.value &lt;= '20')'</pre>

                    <h2 id="and-or-or">AND or OR, or is that OR and AND?</h2>

                    <p>Finally, we come to the boolean operators. It's the rare moment where we're only filtering by one
                        attribute. Fortunately, OpenMage's Collections have us covered. You can chain together multiple
                        calls to <tt>addFieldToFilter</tt> to get a number of "AND" queries.</p>

                    <pre>
function testAction()
{
    echo
        (string)
        Mage::getModel('catalog/product')
            ->getCollection()
            ->addFieldToFilter('sku',array('like'=>'a%'))
            ->addFieldToFilter('sku',array('like'=>'b%'))
            ->getSelect();
}
</pre>

                    <p>By chaining together multiple calls as above, we'll produce a where clause that looks something
                        like the following</p>

                    <pre>WHERE (e.sku like 'a%') AND (e.sku like 'b%')</pre>

                    <p>To those of you that just raised your hand, yes, the above example would always return 0 records.
                        No sku can begin with BOTH an <tt>a</tt> and a <tt>b</tt>. What we probably want here is an <tt>OR</tt>
                        query. This brings us to another confusing aspect of <tt>addFieldToFilter</tt>'s second
                        parameter.</p>

                    <p>If you want to build an <tt>OR</tt> query, you need to pass an Array of filter Arrays in as the
                        second parameter. I find it's best to assign your individual filter Arrays to variables </p>

                    <pre>
public function testAction()
{
    $filter_a = array('like'=>'a%');
    $filter_b = array('like'=>'b%');
}
</pre>

                    <p>and then assign an array of all my filter variables</p>
                    <pre>
public function testAction()
{
    $filter_a = array('like'=>'a%');
    $filter_b = array('like'=>'b%');
    echo
        (string)
        Mage::getModel('catalog/product')
            ->getCollection()
            ->addFieldToFilter('sku', array($filter_a, $filter_b))
            ->getSelect();
}
</pre>

                    <p>In the interest of being explicit, here's the aforementioned array of filter arrays.</p>
                    <pre>array($filter_a, $filter_b)</pre>

                    <p>This will gives us a WHERE clause that looks something like the following</p>

                    <pre>WHERE (((e.sku like 'a%') or (e.sku like 'b%'))) </pre>

                    <h2 id="wrap-up">Wrap Up</h2>

                    <p>You're now a OpenMage developer walking around with some serious firepower. Without having to
                        write a single line of SQL you now know how to query OpenMage for any Model your store or
                        application might need. </p>

                </div>
                <!-- /.content-wrap -->
                <div class="page-info">
                    <div class="github-link">
                        <a class="improve-page"
                           href="https://github.com/OpenMage/devdocs/blob/master/guides/v19.x/install-gde/install-flow-diagram.md"
                           target="_blank">
                            Edit this page on GitHub
                        </a>
                    </div>
                    <div class="new-issue">
                        <a href="https://github.com/OpenMage/devdocs/issues/new?title=Feedback on page: /guides/v19.x/install-gde/install-flow-diagram.html"
                           target="_blank">
                            Give us feedback
                        </a>
                    </div>
                </div>
            </section>
            <!-- /.content -->
        </div> <!-- /.content-container -->
    </div>
    <!-- /.main-container -->
</div>
<!-- /#gl-wrapper -->

<!-- footer-->
<div class="page-footer">
    <div class="container">
        <div class="copyright-links">
            <ul class="nav footer-links">
                <li class=" " role="menuitem">
                    <a href="https://github.com/OpenMage/devdocs/blob/master/.github/CONTRIBUTING.md">Become a
                        Contributor</a>
                </li>
                <li class=" " role="menuitem">
                    <a href="https://glossary.magento.com/">Glossary</a>
                </li>
                <li class=" " role="menuitem">
                    <a href="/guides/v19.x/release-notes/bk-release-notes.html">Release Notes</a>
                </li>
                <li class=" " role="menuitem">
                    <a href="/magento-third-party.html">Third-Party Licenses</a>
                </li>
            </ul>
        </div>
        <div class="copyright-date">&copy; 2024 OpenMage. All rights reserved.</div>
    </div>
</div>
<!-- / #footer -->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="/assets/js/app.min.js"></script>
</body>
</html>